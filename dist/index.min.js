"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const isHTML=e=>e instanceof HTMLElement;class ControlledFocus{constructor(e){Object.defineProperty(this,"$children",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"loop",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"preventScroll",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"closest",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty(this,"focusableNodes",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"index",{enumerable:!0,configurable:!0,writable:!0,value:-1});const{root:t,children:r="*",loop:s=!0,preventScroll:o=!1,closest:i}=e;isHTML(t)&&(this.$children=[...t.querySelectorAll(`${r||"*"}`)],this.loop=s,this.preventScroll=o,this.closest=i||r,this.focusableNodes=this.$children.length?[...this.$children].filter(e=>{return!!(isHTML(e)&&(parseInt(e.getAttribute("tabindex")||"-1")>-1||e.tabIndex>-1)&&!e.getAttribute("disabled"))&&(this.closest?e.closest(this.closest):e)}):null,this.focusableNodes&&(this.index=this.focusableNodes.length&&this.focusableNodes.indexOf(this.focusableNodes.find(e=>e.isSameNode(e.ownerDocument.activeElement)))))}forward(e=0){if(!this.focusableNodes||!this.focusableNodes.length)return;const t="object"==typeof this.preventScroll?this.preventScroll.forward:this.preventScroll,r=this.index+1+e>this.focusableNodes.length-1?this.loop?0:this.focusableNodes.length-1:this.index+1+e;this.focusableNodes[r].focus({preventScroll:t}),this.destroy()}backward(e=0){if(!this.focusableNodes||!this.focusableNodes.length)return;const t="object"==typeof this.preventScroll?this.preventScroll.backward:this.preventScroll,r=this.index-1-e<0?this.loop?this.focusableNodes.length-1:0:this.index-1-e;this.focusableNodes[r].focus({preventScroll:t}),this.destroy()}destroy(){this.$children=[],this.focusableNodes=null}}function error(){throw new Error("UiTrapFocus not setup properly")}class UiTrapFocus{constructor(e={}){Object.defineProperty(this,"isForward",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"isBackward",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"children",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"closest",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"loop",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"preventScroll",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"steps",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_name",{enumerable:!0,configurable:!0,writable:!0,value:"**UiTrapFocus"});const t=e=>!e.ctrlKey&&!e.metaKey&&!e.altKey&&/^tab$/i.test(e.code)||9===e.keyCode,{forward:r=(e=>t(e)&&!e.shiftKey),backward:s=(e=>t(e)&&e.shiftKey),children:o="",closest:i="",loop:l=!1,preventScroll:a=!1,steps:c=0}=e;this.isForward=r,this.isBackward=s,this.children=o,this.loop=l,this.closest=i,this.preventScroll=a,this.steps=c}controlledFocus(e){return new ControlledFocus({root:e.currentTarget,children:this.children,closest:this.closest,loop:this.loop,preventScroll:this.preventScroll})}get step(){return{forward:"object"==typeof this.steps?this.steps.forward:this.steps,backward:"object"==typeof this.steps?this.steps.backward:this.steps}}get sameInstance(){return"**UiTrapFocus"===this._name}init(e){if(!this.sameInstance)return error();const t=this.controlledFocus(e);if(this.isForward(e))return e.preventDefault(),t.forward(this.step.forward);this.isBackward(e)&&(e.preventDefault(),t.backward(this.step.backward))}forward(e){if(!this.sameInstance)return error();e.preventDefault(),this.controlledFocus(e).forward(this.step.forward)}backward(e){if(!this.sameInstance)return error();e.preventDefault(),this.controlledFocus(e).backward(this.step.backward)}}exports.default=UiTrapFocus;